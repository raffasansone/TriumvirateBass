version: 2.1
executors:
  juce-docker-executor:
    docker:
      - image: cimg/base:stable
        auth:
          # ensure you have first added these secrets
          # visit app.circleci.com/settings/project/github/raffasansone/TriumvirateBass/environment-variables
          username: $DOCKER_HUB_USER
          password: $DOCKER_HUB_PASSWORD
          
jobs:
  macos-build:
    macos:
      xcode: 13.4.1
       
    steps:
      - checkout
      
      - run: 
            name: Sync and Update Submodules
            command: 
                git submodule sync --recursive 
                && git submodule update --init --recursive
                && ls ff_meters
                && ls JUCE
                
      - run: 
            name: XCode Build 
            command: xcodebuild -project Builds/MacOSX/TriumvirateBass.xcodeproj -alltargets -parallelizeTargets -configuration Release build
      
      - run:
            name: Package App
            command: tar -cvzf TriumvirateBass.tar Users/distiller/project/Builds/MacOSX/build/Release/TriumvirateBass.app  
      
      - store_artifacts: 
            path: TriumvirateBass.tar
            destination: TriumvirateBass_Standalone
      
      -store_artifacts:
            path: /Users/distiller/Library/Audio/Plug-Ins
          
workflows:
  juce-build-workflow:
    jobs:
      - macos-build